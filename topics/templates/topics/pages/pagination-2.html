{% extends "topics/base.html" %}

{% block title %}ç¿»é¡µç½‘é¡µ2{% endblock %}
{% block question %}
<h1>æ‚¨å¥½ğŸ¦†, çˆ¬è™«er~ğŸ‘‹</h1>
    <h3>
   å‡ºbugäº†å—ï¼ŸğŸ«£
    </h3>
    æ€ä¹ˆåˆå›åˆ°åˆ—è¡¨é¡µäº†ï¼Ÿå“ï¼Œå¯¹ä¸èµ·äº†ğŸ¥ºï¼Œç›´æ¥æŠŠé¢˜ç›®åˆ—è¡¨é¡µé¢copyè¿‡æ¥äº†ã€‚<br>
    å‘ç°è¿™ä¸ªç¿»é¡µåˆ—è¡¨ä¸ä¸Šä¸ªç¿»é¡µåˆ—è¡¨çš„åŒºåˆ«äº†å§ï¼è¯·é—®æ¯é¡µéƒ½ç‚¹ä¸€ä¸‹è¯·æ±‚äº†å‡ æ¬¡æ•°æ®æ¥å£ï¼Ÿ
</div>
{% endblock %}
{% block content %}
    <div class="card text-center">
        <div class="card-header h5">
            é¢˜ç›®åˆ—è¡¨
        </div>
        <div class="card-body">
                <div class="table-container container flex-container justify-content-center">
                    <table class="table table-primary table-striped table-hover w-auto">
                        <thead>
                        <tr>
                            <th class="fixed-column" scope="col">#</th>
                            <th class="fixed-column" scope="col" data-bs-toggle="tooltip" data-bs-html="true"
                                title="åç§°">
                                åç§°
                            </th>
                            <th class="fixed-column" scope="col">é“¾æ¥</th>
                        </tr>
                        </thead>
                        <tbody id="data-body-fixed">
                        </tbody>
                    </table>
                    <div class="table-responsive">
                        <table class="table table-primary table-striped table-hover scrollable-table">
                            <thead>
                            <tr>
                                <th scope="col">éš¾åº¦</th>
                                <th scope="col">çŠ¶æ€</th>
                                <th scope="col">é¢˜è§£</th>
                                <th scope="col">ç±»åˆ«</th>
                                <th scope="col">ç®€ä»‹</th>
                            </tr>
                            </thead>
                            <tbody id="data-body-scroll">
                            </tbody>
                        </table>
                    </div>
                </div>
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center" id="pagination">
                    </ul>
                </nav>
        </div>
    </div>

{% endblock %}

{% block script %}
    <script>
        // æ¯é¡µæ˜¾ç¤ºçš„è®°å½•æ•°
        const itemsPerPage = 10;
        let currentPage = 1;
        let data = [];

        // å‡½æ•°ï¼šç”Ÿæˆå¸¦æœ‰é»˜è®¤æç¤ºæ¡†çš„å•å…ƒæ ¼
        function createTooltipCell(text, type = 'text', link = '', tooltipTitle = text) {
            var cell;
            var element;

            if (type === 'link') {
                element = $('<a>').attr({
                    'href': link,
                    'target': '_blank'  // æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥
                }).text(text);
            } else {
                element = $('<span>').text(text);
            }

            element.attr({
                'data-bs-toggle': 'tooltip',
                'data-bs-html': 'true',
                'title': tooltipTitle
            });

            cell = $('<td>').append(element);
            return cell;
        }

        // å‡½æ•°ï¼šç”ŸæˆåŒ…å«æ–‡æœ¬å›¾æ ‡å’Œè§†é¢‘å›¾æ ‡çš„å•å…ƒæ ¼
        function createSolutionCell(docLink, videoLink) {
            var cell = $('<td>');
            {# style="cursor:pointer; margin-right: 10px;"#}
            var docIcon = $('<i class="bi bi-markdown" style="cursor:pointer; margin:0 5px;font-size: 1.2rem;"></i>');
            var videoIcon = $('<i class="bi bi-play-btn" style="cursor:pointer; margin:0 5px;font-size: 1.2rem;"></i>');

            docIcon.attr('title', 'æ–‡æ¡£è§£æ').tooltip();
            videoIcon.attr('title', 'è§†é¢‘è§£æ').tooltip();

            docIcon.on('click', function () {
                window.open(docLink, '_blank');
            });

            videoIcon.on('click', function () {
                window.open(videoLink, '_blank');
            });

            cell.append(docIcon).append(videoIcon);
            return cell;
        }

        function createStatusCell(status) {
            var text = status ? 'é€šè¿‡' : 'æœªé€šè¿‡'
            var cell;
            var element;
            if (status) {
                element = $('<span>').text(text).addClass('badge bg-success');

            } else {
                element = $('<span>').text(text).addClass('badge bg-warning  text-dark');

            }

            element.attr({
                'data-bs-toggle': 'tooltip',
                'data-bs-html': 'true',
                'title': text
            });

            cell = $('<td>').append(element);
            return cell;
        }

        // å‡½æ•°ï¼šæ¸²æŸ“è¡¨æ ¼å†…å®¹
        function renderTable(page) {
            $('#data-body-fixed').empty();
            $('#data-body-scroll').empty();

            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;

            const pageData = data.slice(start, end);

            $.each(pageData, function (index, topic) {
                var row_fixed = $('<tr>');
                var row_scroll = $('<tr>');

                row_fixed.append(createTooltipCell(topic.order_id));
                row_fixed.append(createTooltipCell(topic.title));
                row_fixed.append(createTooltipCell("Go", 'link', topic.response_path, "ç‚¹å‡»æŸ¥çœ‹é¢˜ç›®è¯¦æƒ…"));

                row_scroll.append(createTooltipCell(topic.difficulty));
                row_scroll.append(createStatusCell(topic.pass_status));
                row_scroll.append(createSolutionCell(topic.solution_txt, topic.solution_video));
                row_scroll.append(createTooltipCell(topic.category));
                row_scroll.append(createTooltipCell(topic.des));

                {#row_scroll.append(createTooltipCell(topic.goal));#}
                {#row_scroll.append(createTooltipCell(topic.question));#}
                {#row_scroll.append(createTooltipCell(topic.difficulty_score));#}
                {#row_scroll.append(createTooltipCell(topic.points));#}

                $('#data-body-fixed').append(row_fixed);
                $('#data-body-scroll').append(row_scroll);
            });

            // åˆå§‹åŒ–æç¤ºæ¡†
            $('[data-bs-toggle="tooltip"]').tooltip();
        }

        // å‡½æ•°ï¼šæ¸²æŸ“åˆ†é¡µæ§ä»¶
function renderPagination(totalItems) {
    const totalPages = Math.ceil(totalItems / itemsPerPage);
    $('#pagination').empty();

    for (let i = 1; i <= totalPages; i++) {
        const li = $('<li>').addClass('page-item').addClass(i === currentPage ? 'active' : '');
        const a = $('<a>').addClass('page-link').attr('href', `?page=${i}`).text(i);
        a.on('click', function (e) {
            e.preventDefault();
            currentPage = i;
            window.history.pushState({}, '', `?page=${i}`);
            renderTable(currentPage);
            renderPagination(data.length);
        });
        li.append(a);
        $('#pagination').append(li);
    }
}
$(document).ready(function () {
    const urlParams = new URLSearchParams(window.location.search);
    const pageParam = urlParams.get('page');
    if (pageParam) {
        currentPage = parseInt(pageParam, 10);
    }

    $.ajax({
        url: '/api/topics/',
        type: 'GET',
        success: function (response) {
            data = response;
            renderTable(currentPage);
            renderPagination(data.length);
        },
        error: function () {
            console.error('è¯·æ±‚å¤±è´¥');
        }
    });
});

    </script>

{% endblock %}